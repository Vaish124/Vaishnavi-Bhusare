{% comment %}
  Figma Gift Guide Grid
{% endcomment %}

<section class="figma-grid wrapper">
  {% if section.settings.grid_title != blank %}
    <h2 class="figma-grid__title">{{ section.settings.grid_title }}</h2>
  {% endif %}

  <div class="figma-grid__list">
    {% for block in section.blocks %}
      {% assign product = block.settings.product %}
      {% if product %}
        <article
          class="figma-grid__item"
          data-product-handle="{{ product.handle }}"
          data-product-id="{{ product.id }}"
        >
          <button type="button" class="figma-grid__btn" aria-label="Open quick view">
            <div class="figma-grid__image">
              {% if product.featured_image %}
                {{ product.featured_image | image_url: width: 800 | image_tag: alt: product.title }}
              {% else %}
                <div class="figma-grid__placeholder">No image</div>
              {% endif %}
            </div>
            <div class="figma-grid__meta">
              <h3 class="figma-grid__name">{{ product.title }}</h3>
              {% if product.price %}
                <div class="figma-grid__price">{{ product.price | money }}</div>
              {% endif %}
            </div>
            <span class="figma-grid__hotspot" aria-hidden="true">+</span>
          </button>
        </article>
      {% endif %}
    {% endfor %}
  </div>

  {%- comment -%} Quick View Modal {%- endcomment -%}
  <div class="figma-modal" id="figmaModal" hidden>
    <div class="figma-modal__backdrop" data-modal-close></div>
    <div class="figma-modal__dialog" role="dialog" aria-modal="true" aria-label="Quick view">
      <button class="figma-modal__close" data-modal-close aria-label="Close">Ã—</button>
      <div class="figma-modal__content">
        <div class="figma-modal__gallery" id="qvGallery"></div>
        <div class="figma-modal__info">
          <h3 id="qvTitle"></h3>
          <div id="qvPrice"></div>
          <div id="qvDesc" class="rte"></div>

          <form id="qvForm">
            <div id="qvOptions"><!-- variant pickers injected here --></div>
            <input type="hidden" name="id" id="qvVariantId" />
            <button type="submit" class="btn" id="qvAddBtn">ADD TO CART</button>
          </form>
          <div id="qvError" class="figma-modal__error" hidden></div>
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Gift Guide Grid",
  "settings": [
    { "type": "text", "id": "grid_title", "label": "Grid title", "default": "Shop by Gift Category" },
    { "type": "text", "id": "auto_color", "label": "Auto-add trigger color value", "default": "Black" },
    { "type": "text", "id": "auto_size", "label": "Auto-add trigger size value", "default": "Medium" },
    { "type": "product", "id": "auto_product", "label": "Product to auto-add when the trigger variant is added", "info": "Example: Soft Winter Jacket" }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "limit": 6,
      "settings": [
        { "type": "product", "id": "product", "label": "Select product" }
      ]
    }
  ],
  "presets": [{ "name": "Gift Guide Grid" }]
}
{% endschema %}

{% stylesheet %}
.figma-grid__list{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:24px}
@media(max-width: 900px){.figma-grid__list{grid-template-columns:repeat(2,1fr)}}
@media(max-width: 600px){.figma-grid__list{grid-template-columns:1fr}}
.figma-grid__btn{display:block;width:100%;text-align:left;border:0;background:transparent;cursor:pointer}
.figma-grid__image img{width:100%;height:auto;display:block;border-radius:12px}
.figma-grid__hotspot{position:absolute;inset:auto 12px 12px auto;background:#000;color:#fff;border-radius:50%;width:36px;height:36px;display:grid;place-content:center;font-weight:700}
.figma-modal[hidden]{display:none}
.figma-modal__backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45)}
.figma-modal__dialog{position:fixed;inset:5% 50% auto 50%;transform:translate(-50%,0);max-width:980px;width:95%;background:#fff;border-radius:14px;overflow:hidden}
.figma-modal__content{display:grid;grid-template-columns:1fr 1fr;gap:24px;padding:24px}
@media(max-width:900px){.figma-modal__content{grid-template-columns:1fr}}
.figma-modal__close{position:absolute;top:8px;right:12px;border:0;background:transparent;font-size:28px;cursor:pointer}
.btn{display:inline-block;padding:.9rem 1.25rem;border-radius:999px;background:#111;color:#fff}
{% endstylesheet %}

{% javascript %}
window.FIGMA_GRID = window.FIGMA_GRID || {};
{% endjavascript %}
