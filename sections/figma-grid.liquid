{% comment %}
  Gift Guide Grid (custom)
  - 6 product blocks (selectable in the customizer)
  - Each block renders a "+" pin that opens a modal
  - Variants rendered dynamically
  - AJAX add-to-cart
  - Optional "auto-add" product when (color == trigger_color AND size == trigger_size)
{% endcomment %}

<section id="gg-grid"
  class="gg-wrap"
  data-trigger-color="{{ section.settings.trigger_color | escape }}"
  data-trigger-size="{{ section.settings.trigger_size | escape }}"
>
  {% if section.settings.grid_title != blank %}
    <h2 class="gg-grid__title">{{ section.settings.grid_title }}</h2>
  {% endif %}

  <div class="gg-grid">
    {% for block in section.blocks %}
      {% assign p = block.settings.product %}
      <article class="gg-card{% if p == blank %} gg-card--placeholder{% endif %}" {{ block.shopify_attributes }}>
        {% if p %}
          {% if p.featured_media %}
            {{ p | media_image: class: 'gg-card__img', loading: 'lazy' }}
          {% endif %}

          <button class="gg-pin"
            aria-label="Show {{ p.title | escape }} details"
            data-product-json-id="prod-{{ block.id }}"
          >
            +
          </button>

          {%- comment -%}
            Embed the product JSON for fast access in JS
          {%- endcomment -%}
          <script type="application/json" id="prod-{{ block.id }}">
            {{ p | json }}
          </script>
        {% else %}
          <div class="gg-card__ph">Select a product</div>
        {% endif %}
      </article>
    {% endfor %}
  </div>

  {%- if section.settings.auto_add_product != blank -%}
    <script type="application/json" id="gg-auto-product">
      {{ section.settings.auto_add_product | json }}
    </script>
  {%- endif -%}
</section>

{%- comment -%}
  Quick-View Modal (one per page)
{%- endcomment -%}
<div class="gg-modal" id="ggModal" hidden>
  <div class="gg-modal__backdrop" data-close></div>
  <div class="gg-modal__dialog" role="dialog" aria-modal="true" aria-label="Quick view">
    <button class="gg-modal__close" data-close aria-label="Close">Ã—</button>

    <div class="gg-modal__content">
      <div class="gg-modal__media" id="ggQvMedia"></div>

      <div class="gg-modal__info">
        <h3 id="ggQvTitle" class="gg-title"></h3>
        <div id="ggQvPrice" class="gg-price"></div>
        <div id="ggQvDesc" class="gg-desc rte"></div>

        <form id="ggQvForm" class="gg-form">
          <div id="ggQvOptions" class="gg-options"><!-- variant pickers injected here --></div>
          <input type="hidden" id="ggQvVariantId" name="id" />
          <button class="gg-btn" type="submit" id="ggQvAddBtn">ADD TO CART</button>
        </form>

        <p id="ggQvError" class="gg-error" hidden></p>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Gift Guide Grid",
  "settings": [
    {
      "type": "text",
      "id": "grid_title",
      "label": "Grid title",
      "default": "Tisso vison in the wild"
    },
    {
      "type": "text",
      "id": "trigger_color",
      "label": "Auto-add trigger color value",
      "default": "Black"
    },
    {
      "type": "text",
      "id": "trigger_size",
      "label": "Auto-add trigger size value",
      "default": "Medium"
    },
    {
      "type": "product",
      "id": "auto_add_product",
      "label": "Product to auto-add when the trigger variant is added",
      "info": "Optional. Example: Soft Winter Jacket"
    }
  ],
  "blocks": [
    {
      "type": "product_card",
      "name": "Product",
      "limit": 6,
      "settings": [
        { "type": "product", "id": "product", "label": "Product" }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [{
    "name": "Gift Guide Grid",
    "blocks": [{ "type": "product_card" },{ "type": "product_card" },{ "type": "product_card" },{ "type": "product_card" },{ "type": "product_card" },{ "type": "product_card" }]
  }]
}
{% endschema %}
